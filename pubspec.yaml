name: verily_workspace
publish_to: none

environment:
  sdk: ^3.11.0

workspace:
  - verily_app
  - verily_client
  - verily_server
  - verily_core
  - verily_ui
  - verily_lints
  - verily_test_utils

dev_dependencies:
  melos: ^7.4.0
  serverpod_cli: 3.3.1

melos:
  name: verily
  sdkPath: .fvm/flutter_sdk

  scripts:
    analyze:
      description: Run dart analyze across all packages.
      exec: dart analyze .

    test:
      description: Run tests in all packages.
      exec: dart test
      packageFilters:
        dirExists: test

    test:flutter:
      description: Run Flutter tests in Flutter packages.
      exec: flutter test
      packageFilters:
        dependsOn: flutter
        dirExists: test

    generate:
      description: Run build_runner in all packages that use it.
      exec: dart run build_runner build --delete-conflicting-outputs
      packageFilters:
        dependsOn: build_runner

    generate:watch:
      description: Run build_runner in watch mode.
      exec: dart run build_runner watch --delete-conflicting-outputs
      packageFilters:
        dependsOn: build_runner

    serverpod:generate:
      description: Run Serverpod code generation.
      run: cd verily_server && dart run serverpod generate

    clean:
      description: Clean all packages.
      exec: flutter clean
      packageFilters:
        dependsOn: flutter

    test:integration:
      description: Run Patrol integration tests.
      run: cd verily_app && flutter test integration_test

    upgrade:
      description: Upgrade dependencies in all packages.
      exec: dart pub upgrade
